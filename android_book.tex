\documentclass[a4paper,hidelinks,10pt,leqno]{report}
\usepackage{kotex}
\usepackage{graphicx}
\usepackage{upquote}
\usepackage{listings}
\usepackage{color}
\usepackage{verbatim} 
\usepackage{hyperref}
\usepackage[margin=1in]{geometry}
\usepackage[T1]{fontenc}
\usepackage{textcomp}
%\usepackage[scale=0.75,twoside,bindingoffset=5mm,a4paper]{geometry}


\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.3,0.3,0.3}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}
\definecolor{purple}{rgb}{0.5, 0.0, 0.5}
\definecolor{burntorange}{rgb}{0.8, 0.33, 0.0}
\definecolor{tearose}{rgb}{1.0, 0.92, 0.8}

\renewcommand\lstlistingname{코드}

\title{안드로이드 컴포넌트의 이해}
\author{네이버 지도지역Cell, 노재춘}

\begin{document}

% http://latexcolor.com
\maketitle
\tableofcontents

\parindent=0em

\lstset {
	language=java, 
	backgroundcolor=\color{backcolour},   
	commentstyle=\color{codegreen},
    keywordstyle=\color{purple},
	tabsize=4,
	showspaces=false, 
	showstringspaces=false, 
	numberstyle=\color{codegray},
	numbers=left,                    
    numbersep=5pt,  
    stepnumber=5,      
	breaklines=true
}

\newpage

\begin{abstract}
잘 만든 앱은 다 그럭저럭이지만, 그렇지 않은 앱은 제각각의 이유가 있다. 여기서는 그럭저럭한 앱을 만드는 원리와 방법을 찾아보고, 문제를 발생시키는 제각각의 이유에 대해서도 얘기해보자.
\end{abstract}

\chapter{안드로이드의 기본}
\input{start}

\section{Looper/Handler}
\input{singlethread}

\chapter{안드로이드 컴포넌트}

\section{Context}
\input{context}

\section{Activity}

\input{activity}
\input{activity2}
%\input{activity2-1}\right 
\input{activity3}
%\section{안드로이드 SDK 도구}

%\input{tools}

%\input{intent}
\input{service}
\input{service2}
\input{contentprovider}
\input{brodcastreceiver}
\input{application}
%\input{binder}

%\input{activitymanager}
%\input{toast}

\begin{comment}

애니메이션이 느릴 때 hardwareAccelation을 조정해봐도 된다.

http://www.androidpub.com/94999 TextView에 marquee 넣기

PopupWindow에는 getWindow가 없어서 배경을 DIMM 할 수 없다.

	LayoutParams params = getWindow().getAttributes();
		params.width = LayoutParams.WRAP_CONTENT;
		params.height = LayoutParams.FILL_PARENT;
		params.dimAmount = .6f;
		getWindow().setAttributes((android.view.WindowManager.LayoutParams)params);
		getWindow().getAttributes().windowAnimations = R.style.GnbDialogAnimation;
		getWindow().addFlags(WindowManager.LayoutParams.FLAG_DIM_BEHIND);
		setCanceledOnTouchOutside(true);
		
Window에는 직접 Animation을 적용하지 않고 style을 사용한다.

   <style name="animationPopup" parent="android:Animation"> 
    	<item name="android:windowEnterAnimation">@anim/push_left_in</item> 
    </style> 
    
		Activity owner = (Activity) getContext();
		Display display = owner.getWindowManager().getDefaultDisplay();
		int screenWidth = display.getWidth();
		int screenHeight = display.getHeight();

		PopupWindow popup = new PopupWindow(LayoutInflater.from(owner).inflate(R.layout.bus_home_bookmark, null), 
				(int)(screenWidth / 3), screenHeight);
		popup.setAnimationStyle(R.style.animationPopup);
		popup.setFocusable(true);
		popup.setBackgroundDrawable(new BitmapDrawable());
		popup.setOutsideTouchable(true);
		
		owner.getWindow().setFlags(WindowManager.LayoutParams.FLAG_DIM_BEHIND,
				WindowManager.LayoutParams.FLAG_DIM_BEHIND);
		popup.showAtLocation(owner.getWindow().getDecorView().getRootView(), Gravity.RIGHT | Gravity.TOP, 0, 0);


padding을 쓸것인가 margin을 쓸 것인가
주의사항: depth 10 이하
가능하면 단순한 레이아웃 사용
ViewStub도 사용 가능(꼭 Activity가 아니라)

style은 왜 android namespace를 쓰지 않는가.


01-15 19:32:31.060 I/PowerManagerService( 1212): go to sleep finished
01-15 19:32:37.780 I/PowerManagerService( 1212): Waking up from sleep...
01-15 19:32:38.300 I/PowerManagerService( 1212): wake up finished
01-15 19:32:43.600 I/PowerManagerService( 1212): Going to sleep by user request...
01-15 19:32:44.030 I/PowerManagerService( 1212): go to sleep finished

http://tasker.wikidot.com/deep-sleep-detective

http://stackoverflow.com/questions/10206021/alarmmanager-not-working-in-sleep-mode

http://www.androiddesignpatterns.com/2013/01/inner-class-handler-memory-leak.html
Handler와 마찬가지로 listener도 메모리 leak 가능성
onDestroy에서 해체하는 게 맞겠음
registerReceiver의 경우는?

finalize로 확인해보면 알 수 있음

wakelock도 잡아놓고 해지 않아면 10분 정도 지나서 자동으로 해지한다.

http://dubroy.com/memory_management_for_android_apps.pdf

http://code.google.com/p/android-protips-location/

noHistory는 finish를 하면 안 보임



AlarmManagerService
PendingIntent FinishedDispatcher가 있다.
PendingIntentRecord extends IIntentSender.Stub  sendInner에서..
ActivityManagerService를 거쳐 

앱 삭제되면 alarm 제거하지만, 업데이트할 때는 alarm 제거하지 않는다.

http://stackoverflow.com/questions/14957645/android-power-management-sleep-mode-etc

http://developer.android.com/reference/android/net/wifi/WifiManager.WifiLock.html은 따로 있다.

http://stackoverflow.com/questions/24770804/how-to-force-deep-sleep-on-android-phone-for-testing

http://www.genymotion.com

http://stackoverflow.com/questions/18471780/android-adb-retrieve-database-using-run-as

WindowManagerImpl addView에서 ViewRootImpl 생성함

/frameworks/base/policy/src/com/android/internal/policy/impl 아래 있음
PhoneWindowManager는 WindowManagerService.makeNewWindowManager로 생성(그래서 하나뿐~~)
WindowManagerService.makeNewWindow(Context context)는 PhoneWindow를 리턴한다.
이것은 Activity.attach에서 생성
DecorView는 PhoneWindow 안의 내부 클래스이다.

ViewRootImpl checkThread에서 스레드문제 확인함

ViewRootImpl은 Handler 상속했는데, JB부터 ViewRootHandler 따로 가지고 있다. 

Manifest는 언제 읽어들이지? 설치할 때인가.. LoadedApk 관련?

GC 관련
http://aroundck.tistory.com/378

권병웅 상
- onStart, onResume 차이
visible, user interaction
discard oldest:  notification 없다. 

PhoneWindow에 target에 따른 차이를 볼 수 있다.

onSaveInstanceState
http://charlesharley.com/2012/programming/views-saving-instance-state-in-android/

proguard 매핑 파일은 프로젝트아래 proguard 디렉토리 아래에 있다.

at android.view.ViewGroup.dispatchHoverEvent(ViewGroup.java:1575)
at android.view.View.dispatchGenericMotionEvent(View.java:7527)
at com.android.internal.policy.impl.PhoneWindow$DecorView.superDispatchGenericMotionEvent(PhoneWindow.java:2190)
at com.android.internal.policy.impl.PhoneWindow.superDispatchGenericMotionEvent(PhoneWindow.java:1522)
at android.app.Activity.dispatchGenericMotionEvent(Activity.java:2506)
at com.android.internal.policy.impl.PhoneWindow$DecorView.dispatchGenericMotionEvent(PhoneWindow.java:2144)
at android.view.View.dispatchPointerEvent(View.java:7643)
at android.view.ViewRootImpl.deliverPointerEvent(ViewRootImpl.java:3682)
at android.view.ViewRootImpl.deliverInputEvent(ViewRootImpl.java:3613)
at android.view.ViewRootImpl.doProcessInputEvents(ViewRootImpl.java:4804)
at android.view.ViewRootImpl.enqueueInputEvent(ViewRootImpl.java:4783)
at android.view.ViewRootImpl$WindowInputEventReceiver.onInputEvent(ViewRootImpl.java:4875)
at android.view.InputEventReceiver.dispatchInputEvent(InputEventReceiver.java:185)
at android.os.MessageQueue.nativePollOnce(Native Method)
at android.os.MessageQueue.next(MessageQueue.java:125)
at android.os.Looper.loop(Looper.java:124)
at android.app.ActivityThread.main(ActivityThread.java:5329)

native so 파일이 있으면, 에뮬레이터에서 HAXM 쓸 수가 없다.(롤리팝)

tpacketcapture로 pcap 파일을 구할 수 있다. 그 이후에 wireshark로 확인한다. Follow TCP Stream으로 확인
http://www.bradcurtis.com/hosts-files-and-the-google-android-emulator/

메모리 문제로 업로드가 안 될 수 있다.
http://blog.andrewray.me/how-to-modify-the-android-emulator-hosts-file/

http://www.kandroid.org/online-pdk/guide/tcpdump.html

proxy 사용하기
http://tleyden.github.io/blog/2013/11/20/debugging-http-traffic-in-android-apps-with-a-proxy/

db access 쪽에  synchronized 거는 경우를 봤다. 면접에서도 들은 내용
query에서 불필요하게 transaction을 건다. 무조건 거는 건 안 된다.

http://lsit81.tistory.com/entry/Android-Debug-상태-체크

Alarm등록된 것은 앱 삭제시 제거한다.

alarmnagerService에서 ACTION_DATE_CHANGED를 발생시킨다. 낮 12시에 되기도 한다.
\end{comment}

\end{document}
